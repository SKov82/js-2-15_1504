<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="normalize.css">
</head>

<body>
    <div id="app">
        <header>
            <div class="logo">E-shop</div>
            <div class="cart">
                <form action="#" class="search-form">
                    <input type="text" class="search-field">
                    <button class="btn-search">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
                <button class="btn-cart" @click="showCart = !showCart">Cart</button>
                <div class="cart-block" v-bind:class="{ hidden: !showCart }">
                    <div class="d-flex">
                        <strong class="d-block">Всего товаров: {{ totalCount }}</strong>
                    </div>
                    <hr>
                    <div class="cart-items" v-for="item of basket" :key="item.id">
                        <div class="cart-item">
                            <!-- <img src="${this.img}" alt=""> -->
                            <div class="product-desc">
                                <p class="product-title">{{ item.name }}</p>
                                <p class="product-quantity">{{ item.quantity }}</p>
                                <p class="product-single-price">{{ item.price }}</p>
                            </div>
                            <div class="right-block">
                                <button name="del-btn" class="del-btn" @click="removeFromBasket(item)">&times;</button>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="d-flex">
                        <strong class="d-block">Общая ст-ть: {{  totalSum }}</strong> 
                    </div>
                </div>
            </div>
        </header>
        <main>
            <div class="products">
                <div class="product-item" v-for="item of items" :key="item.id">
                    <img src="https://placehold.it/300x200" alt="">
                    <div class="desc">
                        <h1>{{ item.name }}</h1>
                        <p>{{ item.price }}</p>
                        <button @click="addToBasket(item)"
                        class="buy-btn" 
                        name="buy-btn"
                        >Купить</button>
                    </div>
                </div>
            </div>
        </main>
        
        
        
    </div>

    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js" integrity="sha384-0pzryjIRos8mFBWMzSSZApWtPl/5++eIfzYmTgBBmXYdhvxPc+XcFEk+zJwDgWbP" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <script>
        let app = new Vue({
            el: '#app', 
            url: 'https://raw.githubusercontent.com/GeekBrainsTutorial/online-store-api/master/responses/catalogData.json',
            data: {
                items: [{id:123, name:'monitor',price:100},{id:234, name:'mouse',price:200}, {id:435, name:'printer',price:150}], // какая то проблема с CORS, не фетчится, так и не смог разобраться
                basket: [],
                showCart: false
            },
            methods: {              
                addToBasket(item) {
                    let find = this.basket.find (product => product.id === item.id)
                    if (find) {
                        find.quantity++
                    } else {
                        this.basket.push ({
                            name: item.name,
                            price: item.price,
                            id: item.id,
                            quantity: 1
                        })
                    }
                },

                removeFromBasket(item) {
                    let find = this.basket.find (product => product.id === item.id)
                    if (find.quantity > 1) {
                        find.quantity--
                    } else {
                        this.basket.splice (this.basket.indexOf(find), 1)
                    }
                }
            },
            mounted() {
                   
                },
            computed: {
                totalCount: function ()  {
                    let totalCount = 0;
                    this.basket.forEach(element => {
                        totalCount+=element.quantity    
                    });
                    return totalCount    
                },

                totalSum: function ()  {
                    let totalSum = 0;
                    this.basket.forEach(element => {
                        totalSum+=element.quantity * element.price    
                    });
                    return totalSum    
                }
                
            },
        });
    </script>
</body>
</html>